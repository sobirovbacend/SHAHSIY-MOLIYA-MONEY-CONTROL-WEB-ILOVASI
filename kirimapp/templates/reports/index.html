{% extends "base.html" %}
{% load i18n %}
{% block page_title %}
{% trans "Hisobotlar" %}
{% endblock %}

{% block title %}Income{% endblock %}

{% block header%}
<header class="h-16 flex items-center justify-between px-4 md:px-8 border-b border-slate-200 dark:border-white/[0.05] bg-white/80 dark:bg-[#0b0e14]/80 backdrop-blur-xl sticky top-0 z-20">
    <div class="flex items-center gap-4">
        <button class="md:hidden p-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">
            <span class="iconify" data-icon="lucide:menu" data-width="20"></span>
        </button>
        <h1 id="page-title" class="text-lg font-semibold text-slate-900 dark:text-white tracking-tight">{% trans "Hisobotlar" %}</h1>
    </div>

    <div class="flex items-center gap-4">
        <button onclick="toggleTheme()" class="theme-toggle bg-slate-200 dark:bg-[#1f2937]">
            <div class="theme-toggle-dot shadow-sm">
                    <span class="iconify text-amber-500 block dark:hidden" data-icon="lucide:sun"
                          data-width="12"></span>
                <span class="iconify text-indigo-400 hidden dark:block" data-icon="lucide:moon"
                      data-width="12"></span>
            </div>
        </button>


                <div class="relative"> <!-- relative qoâ€˜shildi -->
            <form method="POST" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit"
                        class="flex items-center gap-2 px-3 py-2 rounded-lg text-slate-500 dark:text-slate-400 hover:text-rose-600 dark:hover:text-rose-500 hover:bg-slate-100 dark:hover:bg-white/[0.05] transition-colors duration-200">
                    <span class="iconify" data-icon="lucide:log-out" data-width="18"></span>
                    <span class="hidden md:inline text-sm font-medium">{% trans "Chiqish" %}</span>
                </button>
            </form>
        </div>
    </div>
</header>
{% endblock %}


{% block contentcontainer %}


<div id="content-area" class="w-full h-full overflow-y-auto p-4 md:p-6 lg:p-8 scroll-smooth bg-gray-50 dark:bg-[#0b0e14]">
    <!-- PAGE 5: HISOBOTLAR (REPORTS) -->
    <div class="w-full">
        <div class="mb-6">
            <h2 class="text-lg font-medium tracking-tight text-gray-900 dark:text-gray-100">{% trans "Hisobot va Analitika" %}</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{% trans "Oylik xarajatlar tahlili." %}</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Kategoriyalar bo'yicha chart -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
                <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-6">{% trans "Kategoriyalar bo'yicha " %}</h3>
                <div class="w-full h-64 flex justify-center">
                    <canvas id="categoriesChart" class="w-full h-full"></canvas>
                </div>
            </div>

            <!--  Oylik Tahlil chart -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
                <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-6">{% trans "Tahlil" %}</h3>
                <div class="w-full h-64">
                    <canvas id="monthlyChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    const categories = {{ categories|safe }};
    const categoryTotals = {{ category_totals|safe }};
    const months = {{ months|safe }};
    const monthTotals = {{ month_totals|safe }};
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        if (categories.length) {
            new Chart(document.getElementById("categoriesChart"), {
                type: "doughnut",
                data: {
                    labels: categories,
                    datasets: [{
                        data: categoryTotals
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        if (months.length) {
            new Chart(document.getElementById("monthlyChart"), {
                type: "line",
                data: {
                    labels: months,
                    datasets: [{
                        label: "{% trans "Chiqimlar" %}",
                        data: monthTotals,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

    });
</script>

{% endblock %}
